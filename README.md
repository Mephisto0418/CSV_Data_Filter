# CSV Data Filter v1.0.4

CSV資料過濾與合併工具 - 一個功能強大的Windows桌面應用程式，用於批量處理、過濾和合併CSV檔案。

## 🚀 功能特色

### 核心功能
- **批量CSV檔案處理** - 支援多個資料夾同時搜尋和處理
- **智慧檔案篩選** - 支援資料夾名稱、檔案名稱和日期條件篩選
- **靈活欄位選擇** - 可自由選擇需要的欄位並自訂輸出名稱（合併輸出時表頭為自訂名稱，篩選時自動以原始欄位名稱比對，即使欄位名稱本身含有括號也能正確處理）
- **強大的資料過濾** - 支援多種條件組合過濾資料列，篩選條件自動忽略大小寫與空白，且正確以原始欄位名稱對應CSV標頭
- **高效能合併** - 優化的檔案合併演算法，大幅提升處理速度
- **多執行緒處理** - 支援並行處理，充分利用系統資源

### 進階功能
- **欄位資料處理**
  - 子字串擷取
  - 數值運算（乘法、加法）
  - 字串替換
  - 正規表達式處理
- **檔案完整性檢查** - 可選擇跳過缺少必要欄位的檔案
- **自訂輸出檔案名稱** - 支援自訂檔案名稱，自動處理重複檔案
- **網路檔案支援** - 支援網路路徑，自動使用robocopy優化複製
- **即時進度顯示** - 詳細的處理進度和日誌記錄

## 📋 系統需求

- **作業系統**: Windows 10/11
- **.NET Runtime**: .NET 8.0 或更高版本
- **記憶體**: 建議 4GB 以上
- **硬碟空間**: 50MB 安裝空間 + 處理檔案所需的暫存空間

## 🛠️ 安裝說明

### 方法一：下載執行檔
1. 從 [Releases](../../releases) 頁面下載最新版本
2. 解壓縮到任意資料夾
3. 執行 `CSV_Data_Filter.exe`

### 方法二：從原始碼編譯
```bash
git clone https://github.com/[your-username]/CSV_Data_Filter.git
cd CSV_Data_Filter/CSV_Data_Filter
dotnet build --configuration Release
```

## 📖 使用說明

### 基本操作流程

1. **設定來源路徑**
   - 點擊「新增路徑」選擇包含CSV檔案的資料夾
   - 可新增多個路徑同時處理

2. **設定篩選條件**（可選）
   - **資料夾篩選**: 根據資料夾名稱包含/排除特定目錄
   - **檔案篩選**: 根據檔案名稱包含/排除特定檔案
   - **日期篩選**: 根據資料夾或檔案的日期進行篩選

3. **選擇欄位**
   - 點擊「獲取欄位」從第一個找到的CSV檔案讀取欄位
   - 選擇需要的欄位並可進行進階設定
   - 支援自訂欄位名稱和資料處理

4. **設定資料過濾**（可選）
   - 新增條件過濾特定的資料列
   - 支援多種比較運算子

5. **設定輸出**
   - 選擇目標資料夾
   - 自訂輸出檔案名稱（可選）
   - 設定其他選項
   - 如果未指定目標資料夾，系統將自動使用「文件」資料夾

6. **執行處理**
   - 點擊「執行」開始處理
   - 即時查看處理進度和日誌

### 進階功能說明

#### 欄位資料處理
- **子字串**: 擷取指定位置和長度的字串
- **數值運算**: 對數值欄位進行乘法和加法運算
- **字串替換**: 將指定文字替換為其他文字
- **正規表達式**: 使用正規表達式移除符合模式的文字

#### 篩選條件運算子
- **包含/不包含**: 檢查欄位值是否包含指定文字（自動忽略大小寫與空白）
- **等於/不等於**: 精確比對欄位值（自動忽略大小寫與空白）
- **開始於/結束於**: 檢查欄位值的開頭或結尾（自動忽略大小寫與空白）
- **大於/小於**: 數值比較（自動轉換為數值）

> **注意：** 篩選條件的欄位名稱會自動以原始CSV標頭比對，合併輸出時則使用自訂欄位名稱作為表頭。即使欄位名稱本身含有括號，移除與篩選皆能正確處理。

## ⚙️ 設定選項

- **處理執行緒數**: 調整並行處理的執行緒數量（預設為CPU核心數的一半）
- **新增檔案名稱欄位**: 在輸出檔案中新增來源檔案名稱欄位
- **新增目錄名稱欄位**: 在輸出檔案中新增來源目錄名稱欄位
- **跳過不完整的檔案**: 當檔案缺少必要欄位時是否跳過處理
- **啟用Debug Log**: 顯示詳細的除錯訊息，協助診斷問題
- **保留暫存檔案**: 處理完成後保留暫存檔案，方便除錯或查看中間處理結果

## 🔧 技術架構

### 核心元件
- **主程式**: `CSV_Data_Filter.cs` - 主要UI和流程控制
- **檔案系統輔助**: `FileSystemHelper.cs` - 檔案搜尋和管理
- **CSV處理器**: `CsvProcessor.cs` - CSV檔案讀取、處理和合併
- **日誌輔助**: `LogHelper.cs` - 執行緒安全的日誌記錄

### 資料模型
- **ColumnConfig**: 欄位配置和處理設定
- **FilterCondition**: 篩選條件定義
- **ProcessType**: 欄位處理類型枚舉
- **FilterOperator**: 篩選運算子枚舉

### 效能優化
- **異步檔案搜尋**: 避免UI執行緒阻塞
- **並行檔案處理**: 多執行緒同時處理多個檔案
- **優化合併演算法**: 直接檔案流複製，避免逐行CSV解析
- **記憶體管理**: 使用yield return避免大量檔案清單佔用記憶體

## 🐛 已知問題

- 處理超大檔案（>1GB）時可能需要較長時間
- 網路路徑處理依賴robocopy，需要適當的網路權限
- 某些特殊字元的CSV檔案可能需要手動調整編碼

## 🔒 安全注意事項

- **防毒/防火牆提示**：由於本程式需要大量存取檔案系統（尤其是在處理NAS上的檔案時），某些防毒軟體或企業防火牆可能會誤判為可疑行為。這是正常現象，您可以：
  - 將程式添加到防毒軟體的白名單或例外清單中
  - 與IT部門協調將應用程式設為信任
  - 使用已簽名的版本（v1.0.1以後的版本都有程式碼簽章）
- **權限要求**：本程式僅需要檔案讀寫權限，不需要管理員權限即可執行
- **網路安全**：存取網路路徑時，請確保您有適當的權限，且網路連線穩定

## 📝 更新日誌

### v1.0.1 (2025-06-03)
- 修正篩選條件邏輯，現在會正確以原始欄位名稱比對（非顯示名稱），完全對應CSV標頭
- 篩選條件比對自動忽略大小寫與空白
- 合併輸出時表頭使用自訂欄位名稱

### v1.0.2 (2025-06-04)
- 修正：即使欄位名稱本身含有括號，移除欄位與篩選條件都能正確處理，不會誤判

### v1.0.3 (2025-06-04)
- 新增：保留暫存檔案選項，方便除錯或查看中間處理結果
- 新增：Debug Log開關，可選擇性顯示詳細除錯訊息
- 新增：欄位配置支援雙擊快速加入/移除欄位
- 修正：暫存檔案路徑衝突導致檔案覆蓋問題，使用唯一檔名確保所有資料正確合併
- 修正：UI初始化問題，確保所有控制項正確建立

### v1.0.4 (2025-06-05)
- 新增：當目標資料夾未指定時，自動使用「文件」資料夾作為預設目標路徑
- 優化：目錄掃描效能提升，避免處理大量目錄時逐漸變慢的問題
- 改進：檔案標題檢查現在與處理檔案一併執行，不再單獨作業

### v1.0.0 (2025-01-05)
- 初始版本發布
- 支援基本CSV檔案過濾和合併功能
- 實作多執行緒處理和進度顯示
- 新增欄位自訂名稱和資料處理功能
- 支援檔案完整性檢查
- 優化網路檔案處理效能

## 🤝 貢獻指南

歡迎提交Issue和Pull Request！

1. Fork 此專案
2. 建立功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交變更 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 開啟 Pull Request

## 📄 授權條款

此專案採用 MIT 授權條款 - 詳見 [LICENSE](LICENSE) 檔案

## 📞 聯絡資訊

如有問題或建議，請透過以下方式聯絡：
- 建立 [Issue](../../issues)
- 電子郵件: [boris850418@gmail.com]

## 🙏 致謝

- [CsvHelper](https://joshclose.github.io/CsvHelper/) - 優秀的CSV處理函式庫
- .NET Team - 提供強大的開發平台 